<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="context-path" th:content="@{/}" />
    <title>DEEP - Update Instance</title>
    <link rel="icon" th:href="@{/admin/images/DEEP Logo.png}" type="image/png">
    <link th:href="@{/css/output.css}" rel="stylesheet">
</head>

<body class="min-h-screen" style="background: linear-gradient(to bottom, #FFFFFF, #D4DFED);">

<!-- Toast Display -->
<div th:replace="~{common/toast-display::toast-display}"></div>

<div class="mx-auto">
    <!-- Header -->
    <div th:replace="~{common/admin-navbar::admin-navbar}"></div>

    <!-- Main Content -->
    <main class="backdrop-blur-lg rounded-3xl px-7 py-4">
        <div class="bg-white rounded-2xl py-2 px-4 md:px-8 mb-4"
             style="box-shadow: 0px 2px 27px -5px rgba(0,0,0,0.2);">
            <h1 class="text-xl lg:text-2xl font-bold text-[#1E3C72]">
                Configure Allocation Instance
            </h1>
        </div>


        <!-- Submission Status -->
        <section class="bg-[#B8D7FF] rounded-2xl px-8 py-4 mb-4" style="box-shadow: 0px 2px 27px -5px rgba(0,0,0,0.2);">
            <div class="flex items-center gap-3 mb-6 lg:mb-8">
                <img th:src="@{/admin/images/external-link.png}" alt="Link Img" class="w-5 h-5 lg:w-5 lg:h-5">
                <h2 class="text-xl lg:text-2xl font-bold text-[#1E3C72]">Submission Status</h2>
            </div>

            <!-- Semesters Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-y-7 md:gap-y-6 gap-x-2 md:gap-x-6 mb-4">
                <!-- Semester Status -->
                <div th:each="entry : ${uploadStatus.entrySet()}" class="flex flex-col items-center text-center space-y-3 lg:mb-0">
                    <div th:classappend="${entry.value == 0} ? 'bg-[#D9D9D9]' : 'bg-[#3DE382]'" class="w-20 h-20 lg:w-24 lg:h-24 rounded-full flex items-center justify-center text-white text-2xl shadow-lg">
                        <img th:src="@{/admin/images/open-book.png}" alt="Checkmark" class="w-10 h-10 lg:w-12 lg:h-12">
                    </div>
                    <div>
                        <div class="font-bold text-gray-800 text-lg lg:text-2xl" th:text="${entry.key}"></div>
                        <div class="text-xs lg:text-md mb-4 md:mb-7" th:text="${entry.value == 0 ? 'Not Submitted' : 'Submitted'}"></div>
                        <div class="text-xs lg:text-xs font-semibold text-gray-800">Available Students Data</div>
                        <div class="text-3xl lg:text-[2.5rem] font-bold text-gray-800" th:text="${entry.value}"></div>
                    </div>
                </div>
            </div>
        </section>

        <form th:action="@{/admin/submit-data}" method="post" enctype="multipart/form-data" class="flex flex-col justify-center text-center mt-6" onsubmit="handleSubmit(event)">
            <!-- Upload Sections -->
            <div class="bg-[#B8D7FF] rounded-3xl grid grid-cols-1 md:grid-cols-2 place-items-center gap-6 md:gap-10 mb-4 p-8 md:px-[6rem] md:py-[3rem]" style="box-shadow: 0px 2px 27px -5px rgba(0,0,0,0.2);">
                <!-- Student Data -->
                <div class="border-2 w-11/12 border-dashed border-black rounded-2xl p-8 text-center bg-gray-50/50 hover:border-indigo-500 transition-all duration-300 group">
                    <img th:src="@{/admin/images/uploading.png}" alt="Student Icon" class="w-10 h-10 mx-auto mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">Student Data</h3>

                    <!-- File Input -->
                    <div class="relative">
                        <label
                                for="fileInput-student-data"
                                class="block w-full bg-blue-100 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg p-4 text-center text-sm cursor-pointer hover:bg-blue-200"
                        >
                                <span id="fileLabel-student-data">
                                    <img th:src="@{/admin/images/file-xlsx.png}" alt="Upload Icon" class="inline-block w-6 h-6 mr-1"> Max upload size: 5MB
                                </span>
                        </label>
                        <input
                                id="fileInput-student-data"
                                type="file"
                                name="student-data"
                                accept=".xlsx"
                                class="hidden"
                                onchange="
                                            const ctx = document.querySelector('meta[name=context-path]').getAttribute('content');
                                            const fileName = this.files[0]?.name;
                                            const label = document.getElementById('fileLabel-student-data');
                                            label.innerHTML = fileName ? fileName : `<img src='${ctx}admin/images/file-xlsx.png' alt='Upload Icon' class='inline-block w-6 h-6 mr-1'> Max upload size: 5MB`;
                                         "
                        />
                    </div>
                </div>

                <!-- Institute Requirements -->
                <div class="border-2 w-11/12 border-dashed border-black rounded-2xl p-8 text-center bg-gray-50/50 hover:border-indigo-500 transition-all duration-300 group">
                    <img th:src="@{/admin/images/uploading.png}" alt="Student Icon" class="w-10 h-10 mx-auto mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">Institute Requirements</h3>

                    <!-- File Input -->
                    <div class="relative">
                        <label
                                for="fileInput-institute-requirements"
                                class="block w-full bg-blue-100 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg p-4 text-center text-sm cursor-pointer hover:bg-blue-200"
                        >
                                <span id="fileLabel-institute-requirements">
                                    <img th:src="@{/admin/images/file-xlsx.png}" alt="Upload Icon" class="inline-block w-6 h-6 mr-1"> Max upload size: 5MB
                                </span>
                        </label>
                        <input
                                id="fileInput-institute-requirements"
                                type="file"
                                name="institute-requirements"
                                accept=".xlsx"
                                class="hidden"
                                onchange="
                                            const ctx = document.querySelector('meta[name=context-path]').getAttribute('content');
                                            const fileName = this.files[0]?.name;
                                            const label = document.getElementById('fileLabel-institute-requirements');
                                            label.innerHTML = fileName ? fileName : `<img src='${ctx}admin/images/file-xlsx.png' alt='Upload Icon' class='inline-block w-6 h-6 mr-1'> Max upload size: 5MB`;
                                         "
                        />
                    </div>
                </div>

                <!-- Course Data -->
                <div class="border-2 w-11/12 border-dashed border-black rounded-2xl p-8 text-center bg-gray-50/50 hover:border-indigo-500 transition-all duration-300 group">
                    <img th:src="@{/admin/images/uploading.png}" alt="Student Icon" class="w-10 h-10 mx-auto mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">Course Data</h3>

                    <!-- File Input -->
                    <div class="relative">
                        <label
                                for="fileInput-course-data"
                                class="block w-full bg-blue-100 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg p-4 text-center text-sm cursor-pointer hover:bg-blue-200"
                        >
                                <span id="fileLabel-course-data">
                                    <img th:src="@{/admin/images/file-xlsx.png}" alt="Upload Icon" class="inline-block w-6 h-6 mr-1"> Max upload size: 5MB
                                </span>
                        </label>
                        <input
                                id="fileInput-course-data"
                                type="file"
                                name="course-data"
                                accept=".xlsx"
                                class="hidden"
                                onchange="
                                            const ctx = document.querySelector('meta[name=context-path]').getAttribute('content');
                                            const fileName = this.files[0]?.name;
                                            const label = document.getElementById('fileLabel-course-data');
                                            label.innerHTML = fileName ? fileName : `<img src='${ctx}admin/images/file-xlsx.png' alt='Upload Icon' class='inline-block w-6 h-6 mr-1'> Max upload size: 5MB`;
                                         "
                        />
                    </div>
                </div>

                <!-- Course Offerings -->
                <div class="border-2 w-11/12 border-dashed border-black rounded-2xl p-8 text-center bg-gray-50/50 hover:border-indigo-500 transition-all duration-300 group">
                    <img th:src="@{/admin/images/uploading.png}" alt="Student Icon" class="w-10 h-10 mx-auto mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">Course Offerings</h3>

                    <!-- File Input -->
                    <div class="relative">
                        <label
                                for="fileInput-course-offerings"
                                class="block w-full bg-blue-100 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg p-4 text-center text-sm cursor-pointer hover:bg-blue-200"
                        >
                                <span id="fileLabel-course-offerings">
                                    <img th:src="@{/admin/images/file-xlsx.png}" alt="Upload Icon" class="inline-block w-6 h-6 mr-1"> Max upload size: 5MB
                                </span>
                        </label>
                        <input
                                id="fileInput-course-offerings"
                                type="file"
                                name="course-offerings"
                                accept=".xlsx"
                                class="hidden"
                                onchange="
                                            const ctx = document.querySelector('meta[name=context-path]').getAttribute('content');
                                            const fileName = this.files[0]?.name;
                                            const label = document.getElementById('fileLabel-course-offerings');
                                            label.innerHTML = fileName ? fileName : `<img src='${ctx}admin/images/file-xlsx.png' alt='Upload Icon' class='inline-block w-6 h-6 mr-1'> Max upload size: 5MB`;
                                         "
                        />
                    </div>
                </div>
            </div>

            <!-- submit Button -->
            <button id="final-submit-btn" type="submit"
                    class="mx-auto text-white px-10 py-3 rounded-2xl text-xl font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2"
                    style="background: linear-gradient(to right, #27AE60, #2ECC71); box-shadow: 0px 2px 27px -5px rgba(0,0,0,0.2);">
                <span id="button-text">Submit</span>
                <svg id="spinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                </svg>
            </button>
        </form>
    </main>
</div>


<script th:inline="javascript">
    const uploadError = [[${uploadError}]];
    const uploadWarning = [[${uploadWarning}]];
    const uploadSuccess = [[${uploadSuccess}]];
    const internalServerError = [[${internalServerError}]];
</script>

<script th:src="@{/common/js/general-utility.js}"></script>
<script th:src="@{/common/js/navbar.js}"></script>
<script th:src="@{/common/js/status-response.js}"></script>
<script th:src="@{/admin/js/update-instance.js}"></script>
</body>
</html>